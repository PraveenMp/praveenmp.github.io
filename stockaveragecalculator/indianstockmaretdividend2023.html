<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Data</title>
    <!-- Add Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .table-container {
            margin-bottom: 20px;
        }

        h3 {
            text-align: center;
            margin: 24px 0;
            color: #056c05;
            font-size: 1.5em;
            font-weight: bold;
        }

        th {
            background-color: #f2f2f2;
        }

        .filter-container {
            margin-bottom: 20px;
        }
    </style>
</head>

<body>

    <div class="container-fluid">
        <h3>Indian Stock Dividend/Interest/Bonus Details for Equity Market 2023 - Data updated Till 26th DEC 2023</h3>

        <!-- Filter input box -->
        <div class="filter-container">
            <label for="companyFilter" class="form-label">Filter by Company Name:</label>
            <input type="text" class="form-control" id="companyFilter" placeholder="Type company name...">
        </div>

        <div id="stockTablesContainer"></div>
     
        <div class="table-responsive">
            <table class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>Number</th>
                        <th>Symbol</th>
                        <th>Company Name</th>
                        <th>Series</th>
                        <th>Purpose</th>
                        <th>Dividend Type</th>
                        <th>Dividend per share</th>
                        <th>Face Value</th>
                        <th>Ex-Date</th>
                        <th>Record Date</th>
                    </tr>
                </thead>
                <tbody id="stockTableBody"></tbody>
            </table>
    </div>

    <!-- Add Bootstrap JS and Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Fetch JSON data from external file
        fetch('data.json')
            .then(response => response.json())
            .then(jsonData => {
                // Group data by Company Name
                var groupedData = groupBy(jsonData, 'COMPANY NAME');

                // Sort the keys alphabetically
                var sortedCompanies = Object.keys(groupedData).sort();

                // Get the container element
                var container = document.getElementById('stockTablesContainer');

                // Filter input box
                var filterInput = document.getElementById('companyFilter');

                // Event listener for filtering
                filterInput.addEventListener('input', function () {
                    var filterValue = filterInput.value.toLowerCase();

                    // Clear the container
                    container.innerHTML = '';

                    // Loop through sorted keys and create tables for each matching company
                    sortedCompanies.forEach(function (company) {
                        if (company.toLowerCase().includes(filterValue)) {
                            // Create a new table for the current company
                            var tableContainer = document.createElement('div');
                            tableContainer.className = 'table-container';
                            container.appendChild(tableContainer);

                            var table = document.createElement('table');
                            table.className = 'table table-bordered table-striped table-responsive';

                            // Create table header
                            var thead = document.createElement('thead');
                            var headerRow = document.createElement('tr');
                            Object.keys(jsonData[0]).forEach(function (key) {
                                var th = document.createElement('th');
                                th.textContent = key;
                                headerRow.appendChild(th);
                            });
                            thead.appendChild(headerRow);
                            table.appendChild(thead);

                            // Create table body
                            var tbody = document.createElement('tbody');
                            groupedData[company].forEach(function (item, index) {
                                var row = document.createElement('tr');
                                // Create and append table cells
                                Object.keys(item).forEach(function (key) {
                                    var cell = document.createElement('td');
                                    cell.textContent = item[key];
                                    row.appendChild(cell);
                                });
                                tbody.appendChild(row);
                            });
                            table.appendChild(tbody);

                            // Append the table to the container
                            tableContainer.appendChild(table);
                        }
                    });
                });

            })
            .catch(error => console.error('Error fetching data:', error));

        // Function to group data by a specified property
        function groupBy(array, property) {
            return array.reduce(function (acc, obj) {
                var key = obj[property];
                if (!acc[key]) {
                    acc[key] = [];
                }
                acc[key].push(obj);
                return acc;
            }, {});
        }

         // Fetch JSON data from external file
         fetch('data.json')
                .then(response => response.json())
                .then(jsonData => {
                    // Get the table body element
                    var tableBody = document.getElementById('stockTableBody');

                    // Filter out rows with specific PURPOSE values or containing "Bonus" or "Rights"
                    var filteredData = jsonData.filter(function(item) {
                        var excludedPurposes = [
                            "Annual General Meeting",
                            "Buy Back",
                            "Interest Payment",
                            "Demerger",
                            "Extra Ordinary General Meeting",
                            "Extra-Ordinary General Meeting",
                            "Extra Oridinary General Meeting",
                            "Extra- Ordinary General Meeting"
                        ];

                        return !(
                            excludedPurposes.includes(item.PURPOSE) ||
                            item.PURPOSE.includes("Bonus") ||
                            item.PURPOSE.includes("Rights") ||
                            item.PURPOSE.includes("Face Value Split (Sub-Division)")
                        );
                    });

                    // Loop through the filtered data and create table rows
                    filteredData.forEach(function(item, index) {
                        // Create a new table row
                        var row = document.createElement('tr');

                        // Create and append table cells
                        var numberCell = document.createElement('td');
                        numberCell.textContent = index + 1; // Start numbering from 1
                        row.appendChild(numberCell);

                        Object.keys(item).forEach(function(key) {
                            var cell = document.createElement('td');

                            // Populate "Dividend Type" based on the content of "Purpose"
                            if (key === 'PURPOSE') {
                                // Add an additional column for "Purpose"
                                var purposeCell = document.createElement('td');
                                purposeCell.textContent = item[key];
                                row.appendChild(purposeCell);

                                // Add an additional column for "Dividend Type"
                                var dividendTypeCell = document.createElement('td');
                                dividendTypeCell.textContent = getDividendType(item[key]);
                                row.appendChild(dividendTypeCell);

                                // Add an additional column for "Dividend per share"
                                var dividendPerShareCell = document.createElement('td');
                                dividendPerShareCell.textContent = extractDividendPerShare(item[key]);
                                row.appendChild(dividendPerShareCell);
                            } else if (key !== 'DIVIDEND_TYPE') {
                                // For other columns, just set the content
                                cell.textContent = item[key];
                                row.appendChild(cell);
                            }
                        });

                        // Append the row to the table body
                        tableBody.appendChild(row);
                    });
                })
                .catch(error => console.error('Error fetching data:', error));

            // Function to determine "Dividend Type" based on "Purpose"
            function getDividendType(purpose) {
                if (purpose.includes("Special Interim Dividend")) {
                    return "Special Interim";
                } else if (purpose.includes("Special")) {
                    return "Special Dividend";
                } else if (purpose.includes("Interim Dividend")) {
                    return "Special Dividend";
                }  else if (purpose.includes("Interim")) {
                    return "Special Dividend";
                }  else if (purpose.includes("Special Dividend")) {
                    return "Special Dividend";
                }           
                else {
                    return "Other";
                }
            }

            // Function to extract numeric and floating values from "Purpose" column
            function extractDividendPerShare(purpose) {
                // Regular expression to match numeric and floating values
                var match = purpose.match(/(\d+(\.\d+)?)/);

                // If a match is found, return the matched value, otherwise return an empty string
                return match ? match[0] : "";
            }
    </script>

</body>

</html>
